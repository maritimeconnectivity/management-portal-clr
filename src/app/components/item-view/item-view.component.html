<div class="clr-row">
    <div class="clr-col-lg-12 clr-col-md-8 clr-col-12">
        <div class="card">
            <div class="card-header">
                {{capitalize(itemType)}} details
            </div>
            <div class="card-block">
                <div class="card-text">
                    <form clrForm>
                        <div class="clr-form-horizontal clr-form-control clr-row"
                            *ngFor="let menu of columnForMenu | keyvalue:sortColumnForMenu">
                            <label class="clr-control-label">{{menu.value.title}}</label>
                            <div class="clr-control-container clr-col-md-10 clr-col-12"
                                ng-reflect-ng-class="clr-col-md-10 clr-col-12">
                                <div class="clr-input-wrapper">
                                    @if (item[menu.key]) {
                                        @if (isTimestampFormat(menu.key)) {
                                            <input clrinput="" type="string" ng-reflect-name="mrn" ng-reflect-required="true"
                                                [value]="convertTimeString(item[menu.key])" id="clr-form-control-1"
                                                class="clr-input ng-untouched ng-pristine ng-invalid ng-star-inserted"
                                                required="" aria-describedby="clr-form-control-1-helper"
                                                [style.width.px]=400>
                                        } @else {
                                            <input clrinput="" type="string" ng-reflect-name="mrn" ng-reflect-required="true"
                                                [value]="item[menu.key]" id="clr-form-control-1"
                                                class="clr-input ng-untouched ng-pristine ng-invalid ng-star-inserted"
                                                required="" aria-describedby="clr-form-control-1-helper"
                                                [style.width.px]=400>
                                        }
                                    } @else {
                                    <input clrinput="" type="string" ng-reflect-name="mrn" ng-reflect-required="true"
                                        [value]="" id="clr-form-control-1"
                                        class="clr-input ng-untouched ng-pristine ng-invalid ng-star-inserted"
                                        required="" aria-describedby="clr-form-control-1-helper"
                                        [style.width.px]=400>
                                    }
                                </div>
                            </div>
                        </div>
                        @if (itemType !== 'role') {
                            <div class="clr-form-horizontal clr-form-control clr-row">
                                <label class="clr-control-label">Active certificates</label>
                                <div class="clr-col-lg-12 clr-col-md-8 clr-col-12">
                                    <app-cert-table context="active" [data]="activeCertificates" (onAdd)="openCertModal()" (onDownload)="downloadCerts($event)" (onRevoke)="revokeCerts($event)" />
                                </div>
                            </div>
                            <div class="clr-form-horizontal clr-form-control clr-row">
                                <label class="clr-control-label">Revoked certificates</label>
                                <div class="clr-col-lg-12 clr-col-md-8 clr-col-12">
                                    <app-cert-table context="revoked" [data]="revokedCertificates" />
                                </div>
                            </div>
                        }
                    </form>
                </div>
            </div>
            <div class="card-footer">
                <button class="btn btn-primary" (click)="edit()">Edit</button>
                <button class="btn btn-danger" (click)="deleteItem()">Delete</button>
            </div>
        </div>
    </div>
</div>

<clr-modal #certModal class="modal" [(clrModalOpen)]="certModalOpened" clrModalSize="lg">
    <div class="modal-title">
            <button aria-label="Close" class="close" type="button" (click)="cancel()">
            </button>
            <h3 class="modal-title">Issue a new certificate</h3>
        </div>
        <div class="modal-body">
            @if (certificateBundle) {
                <div class="clr-col-sm-12 clr-col-md-12">
                    <p>Here is your certificate bundle. You can download it by clicking the button below.</p>
                </div>
            } @else {
                <div class="clr-col-sm-12 clr-col-md-12">
                    <clr-radio-container clrInline>
                        <label>Choose method</label>
                        <clr-radio-wrapper>
                          <input type="radio" clrRadio name="options" required (click)="issueManualKeystore()" checked/>
                          <label>Issue a cert locally with manual keystore setup</label>
                        </clr-radio-wrapper>
                        <clr-radio-wrapper>
                          <input type="radio" clrRadio name="options" required (click)="issueFromBrowser()"/>
                          <label>Issue a cert locally from browser</label>
                        </clr-radio-wrapper>
                        <clr-control-error>This field is required!</clr-control-error>
                    </clr-radio-container>
                </div>
                <div class="clr-col-sm-12 clr-col-md-12">
                    @if (!fromBrowser) {
                        <p>Many operating systems and browsers require that certificates are
                            imported as a password protected PKCS#12 keystore.
                            If you want to manually generate the keystore, which is the recommended approach, click the corresponding button below and download the resulting zip file, unzip it and then use OpenSSL
                            to generate the keystore using the following command:
                            <br><br><pre>openssl pkcs12 -export -out keystore.p12 -in Certificate_NAME.pem -inkey PrivateKey_NAME.pem</pre>
                          This will prompt you for a passphrase to protect the keystore. If successful the command will
                          result in a PKCS#12 keystore file called 'keystore.p12'.
                          <br>If you don't want to generate a keystore at all you can just skip executing the OpenSSL command.
                          </p>
                    } @else {
                        <p>
                            Many operating systems and browsers require that certificates are
                            imported as a password protected PKCS#12 keystore. You can let your browser generate a keystore for you. NOTE that this action will take a little while and the resulting keystore will
                            NOT be compatible with most major operating systems and browsers.
                        </p>
                    }
                </div>
            }
        </div>
        <div class="modal-footer">
            @if (certificateBundle) {
                <button class="btn btn-primary" type="button" (click)="download()">Download certificate</button>
                <button class="btn btn-outline" type="button" (click)="cancel()">Close</button>
            } @else {
                <button class="btn btn-primary" type="button" (click)="issue()">Issue</button>
            <button class="btn btn-outline" type="button" (click)="cancel()">Cancel</button>
            }
            
        </div>
</clr-modal>
